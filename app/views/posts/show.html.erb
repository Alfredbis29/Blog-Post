<div class="container is-max-desktop mt-6">
  <div class="box">
    <div class="level mb-5">
      <div class="level-left">
        <div class="level-item">
          <h1 class="title is-2"><%= @post.title %></h1>
        </div>
      </div>
      <div class="level-right">
        <div class="level-item">
          <%= link_to 'Back to Posts', posts_path, class: 'button is-light' %>
        </div>
      </div>
    </div>

    <div class="content is-medium">
      <p class="subtitle is-6 has-text-grey mb-4">
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-user"></i>
          </span>
          <span>By <%= @post.author %></span>
        </span>
        <span class="mx-3">•</span>
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-calendar"></i>
          </span>
          <span><%= @post.created_at.strftime("%B %d, %Y at %I:%M %p") %></span>
        </span>
      </p>

      <div class="post-content">
        <%= simple_format(@post.content) %>
      </div>
    </div>

    <div class="buttons mt-5">
      <%= link_to 'Edit', edit_post_path(@post), class: 'button is-primary' %>
      <%= link_to 'Delete', @post, 
          data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete this post?' }, 
          class: 'button is-danger' %>
      <%= link_to 'Back to Posts', posts_path, class: 'button is-light' %>
    </div>
  </div>

  <!-- Comments section -->
  <div class="box mt-5">
    <h2 class="title is-4">Comments</h2>

    <% if @post.comments.any? %>
      <div class="content">
        <% @post.comments.order(created_at: :desc).each do |comment| %>
          <article class="media mb-4">
            <div class="media-content">
              <div class="content">
                <p>
                  <strong><%= comment.author_name %></strong>
                  <span class="has-text-grey is-size-7">
                    • <%= time_ago_in_words(comment.created_at) %> ago
                  </span>
                  <br>
                  <%= simple_format(comment.body) %>
                </p>
              </div>
              <nav class="level is-mobile">
                <div class="level-left">
                  <%= link_to 'Delete', post_comment_path(@post, comment),
                        data: { turbo_method: :delete, turbo_confirm: 'Delete this comment?' },
                        class: 'level-item has-text-danger is-size-7' %>
                </div>
              </nav>
            </div>
          </article>
        <% end %>
      </div>
    <% else %>
      <p class="has-text-grey-light is-italic">No comments yet. Be the first to share your thoughts.</p>
    <% end %>
  </div>

  <!-- New comment form (hidden until button click) -->
  <div class="box mt-4" data-controller="comment-form">
    <div class="field">
      <button type="button"
              class="button is-primary"
              data-action="click->comment-form#toggle">
        Add a comment
      </button>
    </div>

    <div data-comment-form-target="form" class="mt-4">
      <h3 class="title is-5">Add a comment</h3>

      <%= form_with model: [@post, @post.comments.build], local: true do |f| %>
        <div class="field">
          <%= f.label :author_name, "Name", class: "label" %>
          <div class="control">
            <%= f.text_field :author_name, class: "input", placeholder: "Your name" %>
          </div>
        </div>

        <div class="field">
          <%= f.label :body, "Comment", class: "label" %>
          <div class="control">
            <%= f.text_area :body, class: "textarea", rows: 4, placeholder: "Write your comment..." %>
          </div>
        </div>

        <div class="field is-grouped">
          <div class="control">
            <%= f.submit "Post Comment", class: "button is-primary" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

